{% extends 'base.html'%}
{% block head %}
  <title>Home</title>
{% endblock %}
{% block div %}
{% if current_user.is_authenticated %}
<div class="row">
    <div class="col-2">
      <legend class="text-info text-center bg-dark">Stories</legend>
      <h4 class="text-info text-center bg-dark">Suggestions for you</h4>
      <h4 class="text-info text-center bg-dark">Trending</h4>
      <hr>
      <div class="footer1">
          <section>
              <ul class="list-group list-group-horizontal-xm">
                    <a href="{{url_for('main.api_page')}}"><li class="list-group-item">API</li></a>
                    <a href="#"><li class="list-group-item">Privacy</li></a>
                    <a href="#"><li class="list-group-item">Terms</li></a>
                    <a href="#"><li class="list-group-item">More</li></a>
              </ul>
          </section>
      </div>
    </div>
    <div class="col-6">
      {% for post in posts %}
      <div class="card mb-3" style="display: '';" id="posters">
        <ul class="nav">
          <li class="nav-item dropdown ">
            <a class="nav-link dropdown-toggle" data-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false"></a>
            <div class="dropdown-menu bg-info">
              {% if current_user.is_following(post.author) %}
              <a class="dropdown-item btn" href="{{url_for('users.report', id = post.id)}}" name = "report">Report</a>
              <a class="dropdown-item" href="{{url_for('users.unfollow', username = post.author.username)}}">Unfollow</a>
              <a class="dropdown-item" href="{{url_for('users.block', username = post.author.username)}}">Block</a>
              <a class="hide-element dropdown-item" href=""  style="display: '';" name="hidden" id="hide1">Hide</a>
              <a class="dropdown-item" href="#">Embed</a>
              
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="#">Cancel</a>
              {% elif not current_user.is_following(post.author) %}
              <a class="dropdown-item" href="#">Report</a>
              <a class="dropdown-item" href="{{url_for('users.block', username = post.author.username)}}">Block</a>
              <a class="hide-element dropdown-item" href="" style="display: ">Hide</a>
              <a class="dropdown-item" href="#">Embed</a>
              <a href="{{ url_for('users.send_message', recipient=post.author.username) }}">Message</a>
              <div class="dropdown-divider"></div>
              <a class="dropdown-item" href="#">Edit</a>
              <a class="dropdown-item" href="#">Cancel</a>
              {% endif %}
            </div>
            </li>
          </ul>
          <div class="card-header">
            <div class="content-section">
              <div class="media">
                <img class="rounded-circle account-img my-img" src="{{url_for('static', filename = 'img/' + post.author.image_file)}}" alt="profile pic">
                
                <div class="media-body">
                    {% if post.author == current_user %}
                    <a href="{{url_for('users.account', username = post.author.username)}}"><h6 class="account-heading username ml-2">{{post.author.fullname}}</h6></a>
                    {% else %}
                    <a href="{{url_for('users.dashboard', username = post.author.username)}}"><h6 class="account-heading username ml-2">{{post.author.fullname}}</h6></a>
                    {% endif %}
                  
                  <p class="card-text"><small class="text-muted">{{post.date_posted.strftime('%Y-%m-%d')}}</small></p>

                </div>
              </div>
            </div>
          </div>
          <img src="{{url_for('static', filename = 'postpics/' + post.picture)}}" class="card-img-top" alt="..." width="50" height="400">

          <div class="card-body">

              <div class="card-footer text-muted">{{post.title}}</div>

              <div class="row">
              </div>
                    <a href="#" class="btn btn-warning mr-4"><i class="fas fa-heart"></i></a>
                    <a href="#" class="btn btn-warning mr-4"><i class="fas fa-share-alt-square"></i></a>
                    <a href="#" class="btn btn-warning mr-4" ><i class="fas fa-shopping-cart"></i></a>
                    <small>
                        <div class="col-6">
                            <form action="" method="POST">
                              <input type="text" name="comment" id="comment" placeholder="Your opinion">
                              <button type="submit" id="commentB">Post</button>
                            </form>
                          </div>
                    </small>
                
          </div>
        </div>
        {% endfor %}
    </div>

    <div class="col">
      <h3 class="text-white text-center bg-primary" style="width: 200px; margin-right:10%; margin-left: 50%;">People You May Follow</h3>
      <div class="" style="overflow: scroll; background-color: red; height: 300px; width: 200px; margin-right:10%; margin-left: 50%;">

        {% for user in Users if user != current_user and not current_user.is_following(user) %}
        <div id = 'list-example' class="">
        <ul class="list-group list-group-horizontal-xm">
          <li class="list-group-item">
            <img src="{{url_for('static', filename = 'img/' + user.image_file)}}" class="rounded-circle account-img my-img img1"></img>
            <a class="ml-2 mr-2" href="{{url_for('users.dashboard', username = user.username)}}" style="font-size: 10px;">{{user.fullname}}</a>
            <div class="">
              <a href="{{url_for('users.follow', username=user.username)}}" class="">Follow</a>
            </div>
          </li>      
    </ul>

        </div>
            
        {% endfor %}
      </div>
    </div>
</div>

{% else %}
            <div class="row">
                <div class="col-3">
              
                </div>
                <div class="col-6">
                  <form class="jumbotron" action="" method="POST">
                    {{form.hidden_tag()}}
                    <fieldset class="form-group">
                      <legend class="border-bottom mb-4 text-info text-center bg-dark">Join For Free Today</legend>
                          <div class="form-group">
                              {{form.email.label(class = 'form-control-label')}}
                              {% if form.email.errors %}
                                  {{form.email(class = 'form-control form-control-sm is-invalid')}}
                                <div class="invalid-feedback">
                                  {%for error in form.email.errors%}
                                    <span>{{error}}</span>
                                  {% endfor %}
                                </div>
                              {% else %}
                                {{form.email(class = 'form-control form-control-sm')}}
                              {% endif %}
                          </div>
                          <div class="form-group">
                              {{form.password.label(class = 'form-control-label')}}
                              {% if form.password.errors %}
                                  {{form.password(class = 'form-control form-control-sm is-invalid')}}
                                <div class="invalid-feedback">
                                  {%for error in form.password.errors %}
                                    <span>{{error}}</span>
                                  {%endfor%}
                                </div>
                              {% else %}
                                {{form.password(class = 'form-control form-control-sm')}}
                              {% endif %}
                          </div>
                    </fieldset>
              
                 <div class="form-group">
                   {{form.submit(class = "btn btn-outline-info")}}
                 </div>
                 <div class="">
                   <small class = 'text-muted'><a href="{{url_for('users.reset_password_token')}}">Forgot Password?</a></small>
              
                 </div>
                 <hr>
                 <div>
                   <small class="text-muted">
                     Don't have an account? <a href="{{url_for('users.register')}}">Join Today</a>
                 </small></div>
              
                  </form>
                </div>
                <div class="col-3">
              
                </div>
              </div>
            {% endif %}

<script type="text/javascript">
  function load(){

  let request = new XMLHttpRequest();
    request.open("POST", "/hide", true);
  request.onload = function(){
    response = request.responseText;
    Data = JSON.parse(response);
        //data1 = data1.data;
     //data1.forEach(add_post);
  }; 
    const data = new FormData();
    data.append('post_id', post.id);
  request.send(data);
    //xhttp.send("start=${start}&end={Ford}");
return false;
};


//This is to make the hide button work
</script>

<script type="text/javascript">
  window.onload =  function () {
  hide = document.querySelector(".hide-element");
  hide.onclick = function (){
  this.parentElement.parentElement.parentElement.parentElement.remove();

  };
};
</script>
           
{% endblock %}
